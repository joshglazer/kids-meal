<div id="calendar-container">
  <h3>Weekly Menu Planner</h3>
  <div class="calendar-grid" id="calendar-grid"></div>

  <h3>Menu</h3>
  <div class="food-cards-grid" id="food-cards-grid"></div>
</div>

<script>
  // Calendar configuration
  const days = [
    { id: "monday", name: "Monday" },
    { id: "tuesday", name: "Tuesday" },
    { id: "wednesday", name: "Wednesday" },
    { id: "thursday", name: "Thursday" },
    { id: "friday", name: "Friday" },
  ];

  // Food items configuration
  const foodItems = [
    { icon: "ðŸ¥š", name: "Hard Boiled Egg" },
    { icon: "ðŸ—", name: "Chicken Nuggets" },
    { icon: "ðŸ•", name: "Pizza" },
    { icon: "ðŸŒ­", name: "Hot Dog" },
    { icon: "ðŸ§€", name: "Mac and Cheese" },
    { icon: "ðŸ”", name: "Hamburger" },
    { icon: "ðŸœ", name: "Noodles" },
    { icon: "ðŸ¥ª", name: "Cheese Sandwich" },
  ];

  // Generate calendar days
  const calendarGrid = document.getElementById("calendar-grid");
  days.forEach((day) => {
    const dayDiv = document.createElement("div");
    dayDiv.className = "calendar-day";
    dayDiv.dataset.dayId = day.id;
    dayDiv.innerHTML = `
      <div class="day-header">${day.name}</div>
      <div class="day-content" id="${day.id}-content">
        <div class="food-drop-zone" data-day="${day.id}">
          <div class="drop-placeholder">Drag food here</div>
        </div>
      </div>
    `;
    calendarGrid.appendChild(dayDiv);

    // Load saved food selection
    const savedFood = localStorage.getItem(`food-${day.id}`);
    if (savedFood) {
      const foodData = JSON.parse(savedFood);
      displayFoodInDay(day.id, foodData);
    }
  });

  // Generate food cards
  const foodCardsGrid = document.getElementById("food-cards-grid");
  foodItems.forEach((food) => {
    const cardDiv = document.createElement("div");
    cardDiv.className = "food-card";
    cardDiv.dataset.foodIcon = food.icon;
    cardDiv.dataset.foodName = food.name;
    cardDiv.innerHTML = `
      <div class="food-icon">${food.icon}</div>
      <div class="food-name">${food.name}</div>
    `;
    foodCardsGrid.appendChild(cardDiv);
  });

  // Track which zone is currently being hovered
  let currentHoverZone = null;
  let dragCheckInterval = null;

  // Initialize SortableJS for each drop zone
  document.querySelectorAll(".food-drop-zone").forEach((zone) => {
    new Sortable(zone, {
      group: {
        name: "food",
        pull: false, // Don't allow items to be pulled from drop zones
        put: true, // Allow items to be put into drop zones
      },
      animation: 150,
      sort: false, // Don't allow sorting within drop zones
      onAdd: function (evt) {
        const dayId = evt.to.dataset.day;
        const foodIcon = evt.item.dataset.foodIcon;
        const foodName = evt.item.dataset.foodName;

        // Remove the dragged item (we'll display it properly)
        evt.item.remove();

        // Only allow one food per day - replace if exists
        const foodData = { icon: foodIcon, name: foodName };
        displayFoodInDay(dayId, foodData);
        localStorage.setItem(`food-${dayId}`, JSON.stringify(foodData));
      },
    });
  });

  // Initialize SortableJS for food cards grid (source)
  new Sortable(foodCardsGrid, {
    group: {
      name: "food",
      pull: "clone", // Clone items when dragging
      put: false, // Don't allow items to be put back
    },
    animation: 150,
    sort: false, // Don't allow reordering of food cards
    onStart: function (evt) {
      // When drag starts, poll to check which drop zone is being hovered
      dragCheckInterval = setInterval(() => {
        const draggedElement =
          document.querySelector(".sortable-drag") ||
          document.querySelector(".sortable-ghost");

        if (draggedElement) {
          const rect = draggedElement.getBoundingClientRect();
          const centerX = rect.left + rect.width / 2;
          const centerY = rect.top + rect.height / 2;

          // Find which drop zone is under the cursor
          const elementBelow = document.elementFromPoint(centerX, centerY);
          const dropZone = elementBelow?.closest(".food-drop-zone");
          console.log(elementBelow);

          // Update highlighting
          if (dropZone !== currentHoverZone) {
            // Remove highlight from previous zone
            if (currentHoverZone) {
              currentHoverZone.classList.remove("drag-over");
            }
            // Add highlight to new zone
            if (dropZone) {
              dropZone.classList.add("drag-over");
            }
            currentHoverZone = dropZone;
          }
        }
      }, 50); // Check every 50ms
    },
    onMove: function (evt) {
      // Remove the 'hover' class from all potential target lists/elements first
      // This ensures only the currently hovered element has the class
      document.querySelectorAll(".food-drop-zone").forEach((list) => {
        list.classList.remove("drag-over");
      });

      // Add the 'hover-target' class to the element being hovered over
      evt.to.classList.add("drag-over");

      // Return true to allow the move, false to prevent it
      return true;
    },
    onEnd: function (evt) {
      // Stop polling and clean up
      if (dragCheckInterval) {
        clearInterval(dragCheckInterval);
        dragCheckInterval = null;
      }

      // Clean up any remaining highlights when drag ends
      document.querySelectorAll(".food-drop-zone").forEach((zone) => {
        zone.classList.remove("drag-over");
      });
      currentHoverZone = null;
    },
  });

  // Display food in a day
  function displayFoodInDay(dayId, foodData) {
    const dropZone = document.querySelector(
      `.food-drop-zone[data-day="${dayId}"]`
    );
    if (dropZone) {
      dropZone.innerHTML = `
        <div class="selected-food">
          <div class="selected-food-icon">${foodData.icon}</div>
          <div class="selected-food-name">${foodData.name}</div>
          <button class="remove-food" data-day="${dayId}">âœ•</button>
        </div>
      `;

      // Add remove button handler
      const removeBtn = dropZone.querySelector(".remove-food");
      removeBtn.addEventListener("click", () => {
        removeFood(dayId);
      });
    }
  }

  // Remove food from a day
  function removeFood(dayId) {
    const dropZone = document.querySelector(
      `.food-drop-zone[data-day="${dayId}"]`
    );
    if (dropZone) {
      dropZone.innerHTML = '<div class="drop-placeholder">Drag food here</div>';
      localStorage.removeItem(`food-${dayId}`);
    }
  }
</script>
